# Fragestellung 1.1: Wie gross ist der Anteil von Gas-, Heizöl- und Elektroheizungen in einer Gemeinde?

Um diese Frage zu beantworten, werden Daten aus dem "Gebäude- und Wohnungsregister" (GWR) verwendet. <br>
[Link zum GWR](https://www.housing-stat.ch/de/index.html)<br>
[Link zur GWR Dokumentation](https://www.housing-stat.ch/de/docs/index.html)<br>
[Link zum GWR Download](https://www.housing-stat.ch/de/madd/public.html)<br>
<br>
Die Daten werden nach Gemeinde und Energiequelle gruppiert und dann die einzelnen Objekte gezählt. <br>
Anschliessend wird die resultierende Liste als CSV-Datei zur weiterverarbeitung bzw. Visualisierung exportiert.<br>
<br>
---
<i> CAS Spatial Data Analytics 2022 </i> ¦ <i> Kommunale Übersicht von Heizsystemen und Energieträgern in Wohngebäuden </i> ¦ <i> Stand: 22.09.2022  </i> ¦ <i> Entwickler: Jürg Reist </i>

### Notebook vorbereiten und die benötigten Daten aus dem GWR einlesen


```python
import pandas as pd
import matplotlib.pyplot as plt
from io import BytesIO
from zipfile import ZipFile
from urllib.request import urlopen

# Datenquelle definieren
url = urlopen("https://public.madd.bfs.admin.ch/ch.zip")

#lesen GWR Daten
zipfile = ZipFile(BytesIO(url.read()))
dfGWRSource = pd.read_csv(zipfile.open('gebaeude_batiment_edificio.csv'),
                         usecols=['GGDENAME', 'GKODE', 'GKODN', 'GENH1', 'GWAERSCEH1', 'GWAERDATH1'],
                         sep='\t')

dfGWRSource.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GGDENAME</th>
      <th>GKODE</th>
      <th>GKODN</th>
      <th>GENH1</th>
      <th>GWAERSCEH1</th>
      <th>GWAERDATH1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aeugst am Albis</td>
      <td>2679647.268</td>
      <td>1237500.347</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Aeugst am Albis</td>
      <td>2680635.900</td>
      <td>1236936.229</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Aeugst am Albis</td>
      <td>2679016.828</td>
      <td>1235828.156</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Aeugst am Albis</td>
      <td>2679677.869</td>
      <td>1237453.256</td>
      <td>7530.0</td>
      <td>869.0</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aeugst am Albis</td>
      <td>2679692.997</td>
      <td>1237491.284</td>
      <td>7530.0</td>
      <td>869.0</td>
      <td>2014-01-14</td>
    </tr>
  </tbody>
</table>
</div>




```python
#Column mit geeigneten Namen
dfGWRSource = dfGWRSource.rename(columns={"GGDENAME": "Gemeinde",
                              "GKODE": "lat",
                              "GKODN": "lon",
                              "GENH1":"Energiequelle",
                              "GWAERSCEH1":"Quelle",
                              "GWAERDATH1": "Update"})
```


```python
dfGWRSource
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gemeinde</th>
      <th>lat</th>
      <th>lon</th>
      <th>Energiequelle</th>
      <th>Quelle</th>
      <th>Update</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aeugst am Albis</td>
      <td>2679647.268</td>
      <td>1237500.347</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Aeugst am Albis</td>
      <td>2680635.900</td>
      <td>1236936.229</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Aeugst am Albis</td>
      <td>2679016.828</td>
      <td>1235828.156</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Aeugst am Albis</td>
      <td>2679677.869</td>
      <td>1237453.256</td>
      <td>7530.0</td>
      <td>869.0</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aeugst am Albis</td>
      <td>2679692.997</td>
      <td>1237491.284</td>
      <td>7530.0</td>
      <td>869.0</td>
      <td>2014-01-14</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3064792</th>
      <td>La Baroche</td>
      <td>2582768.637</td>
      <td>1251359.261</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3064793</th>
      <td>La Baroche</td>
      <td>2582743.072</td>
      <td>1251406.135</td>
      <td>7530.0</td>
      <td>860.0</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3064794</th>
      <td>La Baroche</td>
      <td>2584600.501</td>
      <td>1251495.804</td>
      <td>7520.0</td>
      <td>860.0</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3064795</th>
      <td>La Baroche</td>
      <td>2583393.948</td>
      <td>1251448.443</td>
      <td>7540.0</td>
      <td>860.0</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3064796</th>
      <td>La Baroche</td>
      <td>2582634.389</td>
      <td>1251094.914</td>
      <td>7540.0</td>
      <td>860.0</td>
      <td>2001-11-29</td>
    </tr>
  </tbody>
</table>
<p>3064797 rows × 6 columns</p>
</div>




```python
# Die Bezeichnungen den Heizcodes zuweisen und als Liste speichern.
# Um die finale Visualisierung auf die drei definierten Energiequellen (Gas, Heizöl, Elektrizität) zu fokussieren, werden die Energiequellen zusammengefasst.
# Im GWR-Datenfile sind folgende Energiequellen definiert:
# 7501: 'Luft', 7510: 'Erdwärme (generisch', 7511: 'Erdwärmesonde', 7512: 'Erdregister', 7513: 'Wasser (Grundwasser, Oberflächenwasser, Abwasser)'
# 7520: 'Gas', 7530: 'Heizöl', 7540: 'Holz (generisch)', 7541: 'Holz (Stückholz)', 7542: 'Holz (Pellets)', 7543: 'Holz (Schnitzel)', 7550: 'Abwärme (innerhalb des Gebäudes)'
# 7560: 'Elektrizität', 7570: 'Sonne (thermisch)', 7580: 'Fernwärme (generisch)', 7581: 'Fernwärme (Hochtemperatur)', 7582: 'Fernwärme (Niedertemperatur)'
# 7598: 'Unbestimmt', 7599: 'Andere'

dfGWRSource['Energiequelle'] = dfGWRSource.Energiequelle.replace({
                                            7500: 'Keine',
                                            7501: 'Weitere',
                                            7510: 'Weitere',
                                            7511: 'Weitere',
                                            7512: 'Weitere',
                                            7513: 'Weitere',
                                            7520: 'Gas',
                                            7530: 'Heizöl',
                                            7540: 'Weitere',
                                            7541: 'Weitere',
                                            7542: 'Weitere',
                                            7543: 'Weitere',
                                            7550: 'Weitere',
                                            7560: 'Elektrizität',
                                            7570: 'Weitere',
                                            7580: 'Weitere',
                                            7581: 'Weitere',
                                            7582: 'Weitere',
                                            7598: 'Unbestimmt',
                                            7599: 'Weitere'
                                            })
```


```python
#Dort wor keine Energiequelle (NULL) angegeben ist, wird der Text "Unbestimmt" gesetzt
dfGWRSource["Energiequelle"].fillna("Unbestimmt", inplace = True)

```


```python
# Die korrekten Bezeichnungen der Informationsquellen zuweisen und als Liste speichern.
dfGWRSource['Quelle'] = dfGWRSource.Quelle.replace({
                                            852: 'Gemäss amtliche Schätzung',
                                            853: 'Gemäss Gebäudeversicherung',
                                            855: 'Gemäss Kontrolle der Heizungseinrichtungen',
                                            857: 'Gemäss Eigentümer/in / Verwaltung',
                                            858: 'Gemäss Gebäudeenergieausweis der Kantone (GEAK)',
                                            859: 'Andere Informationsquelle',
                                            860: 'Gemäss Volkszählung 2000',
                                            864: 'Gemäss Daten des Kantons',
                                            865: 'Gemäss Daten der Gemeinde',
                                            869: 'Gemäss Baubewilligung',
                                            870: 'Gemäss Versorgungswerk (Gas, Fernwärme)',
                                            871: 'Gemäss Minergie'
                                            })
```


```python
dfGWRSource
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gemeinde</th>
      <th>lat</th>
      <th>lon</th>
      <th>Energiequelle</th>
      <th>Quelle</th>
      <th>Update</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aeugst am Albis</td>
      <td>2679647.268</td>
      <td>1237500.347</td>
      <td>Heizöl</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Aeugst am Albis</td>
      <td>2680635.900</td>
      <td>1236936.229</td>
      <td>Heizöl</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Aeugst am Albis</td>
      <td>2679016.828</td>
      <td>1235828.156</td>
      <td>Heizöl</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2002-09-05</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Aeugst am Albis</td>
      <td>2679677.869</td>
      <td>1237453.256</td>
      <td>Heizöl</td>
      <td>Gemäss Baubewilligung</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aeugst am Albis</td>
      <td>2679692.997</td>
      <td>1237491.284</td>
      <td>Heizöl</td>
      <td>Gemäss Baubewilligung</td>
      <td>2014-01-14</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3062575</th>
      <td>La Baroche</td>
      <td>2582768.637</td>
      <td>1251359.261</td>
      <td>Heizöl</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3062576</th>
      <td>La Baroche</td>
      <td>2582743.072</td>
      <td>1251406.135</td>
      <td>Heizöl</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3062577</th>
      <td>La Baroche</td>
      <td>2584600.501</td>
      <td>1251495.804</td>
      <td>Gas</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3062578</th>
      <td>La Baroche</td>
      <td>2583393.948</td>
      <td>1251448.443</td>
      <td>Weitere</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2001-11-29</td>
    </tr>
    <tr>
      <th>3062579</th>
      <td>La Baroche</td>
      <td>2582634.389</td>
      <td>1251094.914</td>
      <td>Weitere</td>
      <td>Gemäss Volkszählung 2000</td>
      <td>2001-11-29</td>
    </tr>
  </tbody>
</table>
<p>3062580 rows × 6 columns</p>
</div>



### Nur die Attribute in ein neues Dataframe speichern, die ausgewertet werden sollen


```python
#Datenframe für Verteilung der Energietrager pro Gemeinde
dfEnergyProGemeinde = dfGWRSource[['Gemeinde', 'Energiequelle']]
dfEnergyProGemeinde
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gemeinde</th>
      <th>Energiequelle</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aeugst am Albis</td>
      <td>Heizöl</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Aeugst am Albis</td>
      <td>Heizöl</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Aeugst am Albis</td>
      <td>Heizöl</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Aeugst am Albis</td>
      <td>Heizöl</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aeugst am Albis</td>
      <td>Heizöl</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3062575</th>
      <td>La Baroche</td>
      <td>Heizöl</td>
    </tr>
    <tr>
      <th>3062576</th>
      <td>La Baroche</td>
      <td>Heizöl</td>
    </tr>
    <tr>
      <th>3062577</th>
      <td>La Baroche</td>
      <td>Gas</td>
    </tr>
    <tr>
      <th>3062578</th>
      <td>La Baroche</td>
      <td>Weitere</td>
    </tr>
    <tr>
      <th>3062579</th>
      <td>La Baroche</td>
      <td>Weitere</td>
    </tr>
  </tbody>
</table>
<p>3062580 rows × 2 columns</p>
</div>



### Zählen aller Gebäude pro Gemeinde und deren Energiequelle inkl. Nullwerte


```python
#Zählt alle Gebäude pro Gemeinde und deren Energiequelle inkl. Nullwerte
dfEnergyProGemeinde = dfEnergyProGemeinde[['Gemeinde', 'Energiequelle']].value_counts(dropna=False).reset_index()
dfEnergyProGemeinde
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gemeinde</th>
      <th>Energiequelle</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Zürich</td>
      <td>Gas</td>
      <td>21642</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Zürich</td>
      <td>Keine</td>
      <td>14192</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Zürich</td>
      <td>Heizöl</td>
      <td>12709</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Zürich</td>
      <td>Weitere</td>
      <td>12028</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Winterthur</td>
      <td>Unbestimmt</td>
      <td>10899</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>12345</th>
      <td>Eptingen</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12346</th>
      <td>Roggenburg</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12347</th>
      <td>Romont (BE)</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12348</th>
      <td>Engelberg</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12349</th>
      <td>Regensberg</td>
      <td>Keine</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>12350 rows × 3 columns</p>
</div>



### Spalten benennen und Daten in ein CSV-File exportieren
Diese CSV ist dann die Grundlage für das Dashboard


```python
#Spaltenaen neu definieren
dfEnergyProGemeinde.columns  = ['Gemeinde', 'Energiequelle','Anzahl']
dfEnergyProGemeinde
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gemeinde</th>
      <th>Energiequelle</th>
      <th>Anzahl</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Zürich</td>
      <td>Gas</td>
      <td>21642</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Zürich</td>
      <td>Keine</td>
      <td>14192</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Zürich</td>
      <td>Heizöl</td>
      <td>12709</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Zürich</td>
      <td>Weitere</td>
      <td>12028</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Winterthur</td>
      <td>Unbestimmt</td>
      <td>10899</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>12345</th>
      <td>Eptingen</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12346</th>
      <td>Roggenburg</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12347</th>
      <td>Romont (BE)</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12348</th>
      <td>Engelberg</td>
      <td>Gas</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12349</th>
      <td>Regensberg</td>
      <td>Keine</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>12350 rows × 3 columns</p>
</div>




```python
#Als CSV-File exportieren
dfEnergyProGemeinde.to_csv('Daten/Gemeindeliste_1-1.csv',sep=',', encoding="utf-8-sig")
```


```python

```
